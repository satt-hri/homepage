function updateViewportDimensions() {
	var w = window, d = document, e = d.documentElement, g = d.getElementsByTagName('body')[0], x = w.innerWidth || e.clientWidth || g.clientWidth, y = w.innerHeight || e.clientHeight || g.clientHeight;
	return { width: x, height: y };
}
var viewport = updateViewportDimensions();


var waitForFinalEvent = (function () {
	var timers = {};
	return function (callback, ms, uniqueId) {
		if (!uniqueId) { uniqueId = "Don't call this twice without a uniqueId"; }
		if (timers[uniqueId]) { clearTimeout(timers[uniqueId]); }
		timers[uniqueId] = setTimeout(callback, ms);
	};
})();


var timeToWaitForLast = 100;


function loadGravatars() {
	viewport = updateViewportDimensions();
	if (viewport.width >= 768) {
		jQuery('.comment img[data-gravatar]').each(function () {
			jQuery(this).attr('src', jQuery(this).attr('data-gravatar'));
		});
	}
}


jQuery(document).ready(function ($) {

	loadGravatars();


	//スクロールしたらヘッダーにクラス追加
	$(function () {
		var headerBar = $('header');
		$(window).scroll(function () {
			hsize = $('header').height();
			if ($(this).scrollTop() > hsize) {
				headerBar.addClass('header-scroll');
			} else {
				headerBar.removeClass('header-scroll');
			}
		});
	});

	$(function () {
		var recruitMenu = $('.nav-open--wh');
		$(window).scroll(function () {
			hsize = $('header').height();
			if ($(this).scrollTop() > hsize) {
				recruitMenu.addClass('header-scroll');
			} else {
				recruitMenu.removeClass('header-scroll');
			}
		});
	});

	const fixedHeader = $('.header');
	const isUp = (function () {
		const scrollElement = document.scrollingElement;
		let flag, prePoint, scrollPoint;
		return function () {
			scrollPoint = scrollElement.scrollTop;
			flag = prePoint > scrollPoint ? true : false;
			prePoint = scrollPoint;
			return flag;
		}
	}());

	window.addEventListener('scroll', () => {
		if (window.pageYOffset > 100) {
			if (isUp()) {
				fixedHeader.addClass('hide');
			} else {
				fixedHeader.removeClass('hide');
			}
		} else {
			fixedHeader.removeClass('hide');
		}
	})


	//ハンバーガーメニューのクラス切り替え
	$("#nav-open").click(function () {
		$(this).toggleClass("active");
	});

	$("#nav-close").click(function () {
		$("#nav-open").removeClass("active");
	});


	// ハンバーガーメニュー内のリンクをクリックでメニューを閉じる
	$('#nav-content a[href]').on('click', function (event) {
		$('#nav-open').trigger('click');
	});


	// TOPへ戻るボタン
	$(function () {
		var pagetop = $('#page_top');

		pagetop.click(function () {
			$('body, html').animate({ scrollTop: 0 }, 500);
			return false;
		});
	});


});


// フェードインアニメーション
window.onload = function () {
	scroll_effect();

	$(window).scroll(function () {
		scroll_effect();
	});

	function scroll_effect() {
		$('.fadein').each(function () {
			var elemPos = $(this).offset().top;
			var scroll = $(window).scrollTop();
			var windowHeight = $(window).height();
			if (scroll > elemPos - windowHeight + 0) {
				$(this).addClass('scrollin');
			}
		});
	}
};


$('.heading--sub01.txtfade .heading-text--en').each(function () {
	$(this).children().addBack().contents().each(function () {
		if (this.nodeType == 3) {
			$(this).replaceWith($(this).text().replace(/(\S)/g, '<span>$1</span>'));
		}
	});
});

$(function () {
	function shuffle(a) {
		var i = a.length;
		while (i) {
			var j = Math.floor(Math.random() * i);
			var t = a[--i];
			a[i] = a[j];
			a[j] = t;
		}
		return a;
	}

	$(document).ready(function () {
		var tbClass = ["txtfade01", "txtfade02", "txtfade03", "txtfade04"];
		var dlTN = $(".heading--sub01.txtfade .heading-text--en span");
		tbClsCnt = tbClass.length;
		shuffle(tbClass);
		itmp = 0;
		dlTN.each(function (i, val) {
			$(this).addClass(tbClass[itmp]);
			if (itmp < tbClsCnt - 1) {
				itmp++;
			} else {
				itmp = 0;
				shuffle(tbClass);
			}
		});
	});
});
